<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Connection (reddit_api_async.Reddit_api_async.Connection)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">reddit_api_async</a> &#x00BB; <a href="../index.html">Reddit_api_async</a> &#x00BB; Connection</nav><header class="odoc-preamble"><h1>Module <code><span>Reddit_api_async.Connection</span></code></h1><p><code>Connection</code> manages the connection to Reddit, including authentication and rate limiting behavior.</p><p>It is responsible for taking the endpoint specifications in <a href="../../../reddit_api_kernel/Reddit_api_kernel/Endpoint/index.html"><code>Reddit_api_kernel.Endpoint</code></a> and actually performing HTTP requests.</p><p>Consider wrapping your <code>Connection</code> in a <a href="../Retry_manager/index.html"><code>Retry_manager</code></a> if you are writing a long-running process and want to just retry forever on transient errors.</p></header><nav class="odoc-toc"><ul><li><a href="#authentication">Authentication</a></li><li><a href="#rate-limiting-behavior">Rate-limiting behavior</a><ul><li><a href="#http-rate-limiting-headers">HTTP rate-limiting headers</a></li><li><a href="#minimum-time-between-requests">Minimum time between requests</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="authentication"><a href="#authentication" class="anchor"></a>Authentication</h2><p><code>Connection</code> currently supports a subset of Reddit's OAuth2 app types via the <a href="Credentials/index.html"><code>Credentials</code></a> module. See <a href="https://github.com/reddit-archive/reddit/wiki/oauth2-app-types">Reddit's documentation on app types</a>.</p><h2 id="rate-limiting-behavior"><a href="#rate-limiting-behavior" class="anchor"></a>Rate-limiting behavior</h2><p><code>Connection</code> enforces two different forms of rate-limiting:</p><h3 id="http-rate-limiting-headers"><a href="#http-rate-limiting-headers" class="anchor"></a>HTTP rate-limiting headers</h3><p>Reddit tracks API usage and requires that a client make no more than 600 requests in a 10 minute period.</p><p>Rather than simply keeping a counter of requests internally, <code>Connection</code> reads Reddit's API response headers to learn about the request quota, including the number of remaining requests and the time until the quota resets. This allows multiple <code>Connection.t</code>s with the same credentials to run in parallel, accounting for each others' quota usage without explicit coordination.</p><h3 id="minimum-time-between-requests"><a href="#minimum-time-between-requests" class="anchor"></a>Minimum time between requests</h3><p>In order to abide by /u/kemitche's <a href="https://www.reddit.com/r/redditdev/comments/1yxrp7/formal_ratelimiting_headers/">request</a> to &quot;be reasonable&quot; and not slam all 600 requests in as quickly as possible, <code>Connection</code> also enforces a 100ms delay between requests.</p><div class="odoc-spec"><div class="spec module" id="module-Credentials" class="anchored"><a href="#module-Credentials" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Credentials/index.html">Credentials</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Access_token_request_error" class="anchored"><a href="#module-Access_token_request_error" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Access_token_request_error/index.html">Access_token_request_error</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An <code>Access_token_request_error.t</code> represents an error encountered while fetching an access token.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Error" class="anchored"><a href="#module-Error" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Error/index.html">Error</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A request via <code>Connection</code> may result in two different HTTP requests: a request to the explicitly named API endpoint and, as necessary, a request to retrieve an OAuth2 access token. This type distinguishes errors associated with each of these requests.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><a href="Credentials/index.html#type-t">Credentials.t</a> <span class="arrow">&#45;&gt;</span></span> <span>user_agent:string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-call" class="anchored"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../reddit_api_kernel/Reddit_api_kernel/Endpoint/index.html#type-t">Reddit_api_kernel.Endpoint.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <span><a href="../../../reddit_api_kernel/Reddit_api_kernel/Endpoint/Error/index.html#type-t">Reddit_api_kernel.Endpoint.Error.t</a> <a href="Error/index.html#type-t">Error.t</a></span> )</span> <span class="xref-unresolved">Core</span>.Result.t</span>
    <span class="xref-unresolved">Async</span>.Deferred.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-call_exn" class="anchored"><a href="#val-call_exn" class="anchor"></a><code><span><span class="keyword">val</span> call_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../reddit_api_kernel/Reddit_api_kernel/Endpoint/index.html#type-t">Reddit_api_kernel.Endpoint.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Async</span>.Deferred.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-call_raw" class="anchored"><a href="#val-call_raw" class="anchor"></a><code><span><span class="keyword">val</span> call_raw : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../reddit_api_kernel/Reddit_api_kernel/Endpoint/index.html#type-t">Reddit_api_kernel.Endpoint.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="xref-unresolved">Cohttp</span>.Response.t * <span class="xref-unresolved">Cohttp</span>.Body.t, <span><span class="xref-unresolved">Core</span>.Exn.t <a href="Error/index.html#type-t">Error.t</a></span> )</span> <span class="xref-unresolved">Core</span>.Result.t</span>
    <span class="xref-unresolved">Async</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>call_raw</code> returns the raw HTTP response from Reddit.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Remote" class="anchored"><a href="#module-Remote" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Remote/index.html">Remote</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Any connection can be turned into an RPC server, acting as a shared connection for multiple client <code>Connection.t</code>s. Rate limiting is managed on the server side.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-For_testing" class="anchored"><a href="#module-For_testing" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_testing/index.html">For_testing</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>